name: ğŸŒ Auto-Ping Sitemap on Push

on:
  push:
    branches:
      - main

jobs:
  ping-search-engines:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ğŸ“¦ Install Dependencies
        run: |
          pip install PyYAML

      - name: ğŸ—ºï¸ Generate or Update Sitemap
        run: |
          python generate_sitemaps.py || echo "âš ï¸ Sitemap script failed, but continuing..."
          touch ai-sitemap.xml

      - name: ğŸ¤– Ping Google & Bing
        run: |
          SITEMAP_URL="https://raw.githubusercontent.com/${{ github.repository }}/main/ai-sitemap.xml"
          echo "ğŸ“¡ Pinging search engines with sitemap: $SITEMAP_URL"

          # Ping Google
          echo "â†’ Notifying Google Search..."
          curl -s -o /dev/null -w "%{http_code}" "http://google.com/ping?sitemap=$SITEMAP_URL" \
            && echo " âœ… Success" \
            || echo " âŒ Failed (but workflow continues)"

          # Ping Bing
          echo "â†’ Notifying Bing + Copilot..."
          curl -s -o /dev/null -w "%{http_code}" "http://www.bing.com/ping?sitemap=$SITEMAP_URL" \
            && echo " âœ… Success" \
            || echo " âŒ Failed (but workflow continues)"

      - name: âœ… Done
        run: |
          echo "ğŸ‰ Auto-ping complete. Search engines notified."
